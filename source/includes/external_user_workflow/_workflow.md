# Getting started

The steps below introduce the workflow about how to connect and consume `AGCO's APIs`.

- [Ask for credentials](#asking-for-credentials)
- [Getting Access](#getting-access)
- [Authentication](#how-to-authenticate)
- [Making Requests](#making-requests)

## Asking for credentials

Access the <a href="https://agco-fuse.github.io/" target="_blank">landing page</a> and require for `sandbox credentials`.
A request will be handled and an email will be sent with the credentials.

Sandbox users have their own data such as `Dealer, Equipment and Telementry data`

## Getting Access

The received email contains:

Property                 | Description
--------                 | -----------
`username`               | the provided email.
`password`               | a random alphanumeric password generated by the system (this need to be changed).
`client_id`              | application identifier to authenticate using `OAuth2`.
`client_secret`          | application secret to authenticate using `OAuth2`.
`url to change password` | New users are required to change their passwords, otherwise authentication will fail.

### Resetting password

A window asking to change/Access the provided `URL` to change your password. You will be required to authenticate using your e-mail address and auto-generated password.

Once authenticated, you will be asked to change your password.

![reset password](images/user_reset_password.png "Reset passowrd")

You also will be required to answer your security questions, as of the image below:

![security questions](images/user_security_questions.png "Security questions")

<aside class="notice">You must answer at least <code>3</code> questions.</aside>

## How to Authenticate

The authentication methods supported by `AGCO's APIs` are [Basic](#basic) and [OAuth2](#oauth2).

### Basic

> `curl` example of Basic authentication

```shell
curl -X GET -u email@example.com:password \
    "https://fuse-equipment-api.herokuapp.com/equipment"
```

For more details about the `HTTP Basic` authentication access the [Mozilla documentation](https://developer.mozilla.org/en-US/docs/Web/HTTP/Basic_access_authentication).


### OAuth2

To authenticate using `OAuth2` just send a request containing the credentials
access token like the `authentication response` example in the right column.

For more details about OAuth2 access the [http://oauth.net/2/](http://oauth.net/2/)

> `curl` example of OAuth2 authentication

```shell
curl -k -X "POST"\
    "https://aaat.agcocorp.com/auth/oauth2/access_token?realm=/dealers"\
    --data-urlencode "username=YOUR_USERNAME"\
    --data-urlencode "password=YOUR_PASSWORD"\
    --data-urlencode "scope=cn mail agcoUUID"\
    --data-urlencode "client_id=YOUR_CLIENT_ID"\
    --data-urlencode "client_secret=YOUR_CLIENT_SECRET"\
    --data-urlencode "grant_type=password"
```

> authentication response

```json
{
  "scope":"mail cn agcoUUID",
  "expires_in":7199,
  "token_type":"Bearer",
  "refresh_token":"2483055a-cb08-4027-a8a9-03f89988d025",
  "access_token":"be9225f4-961a-49c5-bd0d-cf36cb855f69"
}
```

### Authentication response fields

Field           | Description
-----           | -----------
`scope`         | Requested scope
`expires_in`    | Token expiration time
`token_type`    | Access token type
`refresh_token` | Refresh token
`access_token`  | Access token

### Making Requests

> Get Equipment list from Equipment API with basic authentication

```shell
curl -X GET \
    -u email@example.com:password \
    "https://fuse-equipment-api.herokuapp.com/equipment"
```

> Get models list from Telemetry API 

```shell
curl -X GET \
    -H "Authorization: Bearer YOUR_ACCESS_TOKEN"\
    "https://agco-fuse-trackers-sandbox.herokuapp.com/models"
```

All requests through `AGCO APIs` are authenticated using `OAuth2 token Bearer` or `username` and `password` as `HTTP Basic` like the previous example.

### How permissions are handled

The `token Bearer` corresponds to the user credentials and the APIs will use it to check which data can be retrieved.
